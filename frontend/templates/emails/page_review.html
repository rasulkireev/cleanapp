{% load mjml %}

{% mjml %}
<mjml>
  <mj-head>
    <mj-attributes>
      <mj-all font-family="system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif" />
      <mj-text padding="0" />
    </mj-attributes>
    <mj-style>
      .meta-label {
        font-size: 13px;
        font-weight: 600;
        color: #374151;
        display: inline-block;
        margin-right: 4px;
      }
      .meta-value {
        font-size: 13px;
        color: #6b7280;
      }
      .field-row {
        margin-bottom: 8px;
        line-height: 1.6;
      }
      .meta-section {
        background-color: #f9fafb;
        border-radius: 6px;
        padding: 12px;
        margin-top: 12px;
        margin-bottom: 16px;
      }
      .meta-section-title {
        font-size: 12px;
        font-weight: 600;
        color: #6b7280;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 8px;
      }
      .meta-tag {
        font-size: 12px;
        color: #6b7280;
        margin-bottom: 4px;
        line-height: 1.4;
      }
      .meta-tag-label {
        font-weight: 600;
        color: #4b5563;
        margin-right: 4px;
      }
      .meta-check {
        color: #10b981;
        margin-right: 4px;
      }
      .meta-cross {
        color: #ef4444;
        margin-right: 4px;
      }
    </mj-style>
  </mj-head>

  <mj-body background-color="#f9fafb">
    <mj-section background-color="#f9fafb" padding="32px 24px 24px">
      <mj-column>
        <mj-text font-size="24px" font-weight="700" color="#111827" align="center">
          Cleanapp
        </mj-text>
      </mj-column>
    </mj-section>

    <mj-section background-color="#f9fafb" padding="0 24px 32px">
      <mj-column>
        <mj-text font-size="16px" color="#111827" line-height="1.5" padding="0 0 12px 0">
          Hi {{ user.first_name|default:user.username }},
        </mj-text>
        <mj-text font-size="15px" color="#4b5563" line-height="1.6">
          It's time to review {{ total_pages }} page{{ total_pages|pluralize }} from your sitemap{{ total_sitemaps|pluralize }}:
        </mj-text>
      </mj-column>
    </mj-section>

    {% for sitemap_data in sitemaps_with_pages %}
    <mj-section background-color="#f9fafb" padding="0 24px {% if forloop.last %}32{% else %}24{% endif %}px">
      <mj-column border="1px solid #e5e7eb" border-radius="8px" padding="0" background-color="#ffffff">
        <mj-text font-size="13px" font-weight="600" color="#374151" text-transform="uppercase" letter-spacing="0.5px" padding="20px 20px 4px">
          {{ sitemap_data.sitemap.sitemap_url }}
        </mj-text>
        <mj-text font-size="13px" color="#6b7280" padding="0 20px 20px">
          {{ sitemap_data.pages_count }} page{{ sitemap_data.pages_count|pluralize }} to review
        </mj-text>

        {% for page in sitemap_data.pages %}
        {% if not forloop.first %}
        <mj-divider border-color="#e5e7eb" border-width="1px" padding="0 20px" />
        {% endif %}

        <mj-text padding="20px 20px 0">
          {% if page.title %}
          <div class="field-row">
            <span class="meta-label">Title:</span>
            <span class="meta-value">{{ page.title }}</span>
          </div>
          {% endif %}

          <div class="field-row">
            <span class="meta-label">Path:</span>
            <span class="meta-value">{{ page.url_path }}</span>
          </div>

          <div class="meta-section">
            <div class="meta-section-title">Meta Tags</div>

            <div class="meta-tag">
              <span class="meta-tag-label">Description:</span>
              {% if page.description %}
                {{ page.description }}
              {% else %}
                <span class="meta-cross">✗</span> Not present
              {% endif %}
            </div>

            <div class="meta-tag">
              <span class="meta-tag-label">Author:</span>
              {% if page.author %}
                {{ page.author }}
              {% else %}
                <span class="meta-cross">✗</span> Not present
              {% endif %}
            </div>

            <div class="meta-tag">
              <span class="meta-tag-label">Keywords:</span>
              {% if page.keywords %}
                {{ page.keywords }}
              {% else %}
                <span class="meta-cross">✗</span> Not present
              {% endif %}
            </div>

            <div class="meta-tag">
              <span class="meta-tag-label">OG Tags:</span>
              {% if page.og_image or page.og_type %}
                <div style="margin-left: 16px; margin-top: 4px;">
                  <div style="margin-bottom: 2px;">
                    type: {% if page.og_type %}{{ page.og_type }}{% else %}<span style="color: #9ca3af;">Not present</span>{% endif %}
                  </div>
                  <div>
                    image: {% if page.og_image %}<a href="{{ page.og_image }}" target="_blank" rel="noopener noreferrer" style="color: #6366f1; text-decoration: underline;">link</a>{% else %}<span style="color: #9ca3af;">Not present</span>{% endif %}
                  </div>
                </div>
              {% else %}
                <span class="meta-cross">✗</span> Not present
              {% endif %}
            </div>

            <div class="meta-tag">
              <span class="meta-tag-label">Twitter:</span>
              {% if page.twitter_card %}
                <div style="margin-left: 16px; margin-top: 4px;">
                  <div style="margin-bottom: 2px;">
                    card: {{ page.twitter_card }}
                  </div>
                  <div>
                    image: {% if page.twitter_image %}<a href="{{ page.twitter_image }}" target="_blank" rel="noopener noreferrer" style="color: #6366f1; text-decoration: underline;">link</a>{% else %}<span style="color: #9ca3af;">Not present</span>{% endif %}
                  </div>
                </div>
              {% else %}
                <span class="meta-cross">✗</span> Not present
              {% endif %}
            </div>

            <div class="meta-tag">
              <span class="meta-tag-label">Schema Validation:</span>
              <a href="https://validator.schema.org/#url={{ page.url|urlencode }}" target="_blank" rel="noopener noreferrer" style="color: #6366f1; text-decoration: underline;">Check structured data</a>
            </div>
          </div>
        </mj-text>

        <mj-button href="{{ page.review_url }}" background-color="#6366f1" color="#ffffff" border-radius="6px" font-size="14px" font-weight="600" padding="0 20px 20px" inner-padding="12px 24px">
          Review This Page
        </mj-button>
        {% endfor %}
      </mj-column>
    </mj-section>
    {% endfor %}

    <mj-section background-color="#f9fafb" padding="30px 20px">
      <mj-column>
        <mj-text font-size="14px" color="#6b7280" align="center" line-height="20px">
          This is an automated reminder to help you keep your pages up to date.
        </mj-text>
        <mj-text font-size="14px" color="#6b7280" align="center" line-height="20px" padding="10px 0 0 0">
          Have questions? Reply to this email and I'll be happy to help!
        </mj-text>
      </mj-column>
    </mj-section>

    <mj-section background-color="#f3f4f6" padding="20px">
      <mj-column>
        <mj-text font-size="12px" color="#9ca3af" align="center">
          © 2025 Cleanapp. All rights reserved.
        </mj-text>
      </mj-column>
    </mj-section>

  </mj-body>
</mjml>
{% endmjml %}
